<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏</title> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; padding: 40px 0; }
        .table-container { background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); padding: 30px; }
        .table thead { background-color: #4b2c9e; color: white; }
        .btn-filter { background-color: #4b2c9e; color: white; border-radius: 8px; }
        .status-badge { background: #e6f4ea; color: #1e8e3e; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    </style>
</head>
<body>

<div class="container mt-4">
    <div class="table-container p-4 bg-white rounded-4 shadow-sm">
        
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4">
            <div class="d-flex align-items-center gap-3">
                <h2 class="fw-bold m-0" style="font-size: 1.5rem;">üìã –ü–æ—Å—Ç—É–ø–∏–≤—à–∏–µ –∑–∞—è–≤–∫–∏</h2>
                <span class="badge rounded-pill bg-light text-dark border">–í—Å–µ–≥–æ: {{ items.count }}</span>
            </div>
            
            <div class="d-flex gap-2">
                <a href="{% url 'home' %}" class="btn btn-outline-secondary btn-sm d-flex align-items-center px-3">
                    üè† <span class="ms-1 d-none d-sm-inline">–ù–∞ –≥–ª–∞–≤–Ω—É—é</span>
                </a>
                <a href="{% url 'export_excel' %}" class="btn btn-outline-success btn-sm d-flex align-items-center gap-2 px-3 shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M5.884 6.68a.5.5 0 1 0-.768.64L7.349 10l-2.233 2.68a.5.5 0 0 0 .768.64L8 10.781l2.116 2.54a.5.5 0 0 0 .768-.641L8.651 10l2.233-2.68a.5.5 0 0 0-.768-.64L8 9.219l-2.116-2.54z"/>
                        <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                    </svg>
                    <span class="d-none d-sm-inline">–í—ã–≥—Ä—É–∑–∏—Ç—å –≤ Excel</span>
                </a>
            </div>
        </div>

        <form method="GET" class="row g-3 mb-4">
            <div class="col-md-5">
                <input type="text" name="search" class="form-control" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ñ–∞–º–∏–ª–∏–∏..." value="{{ request.GET.search }}">
            </div>
            <div class="col-md-4">
                <select name="sort" class="form-select">
                    <option value="-id">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å: –°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                    <option value="first_name" {% if request.GET.sort == 'first_name' %}selected{% endif %}>–ü–æ –∏–º–µ–Ω–∏ (–ê-–Ø)</option>
                    <option value="last_name" {% if request.GET.sort == 'last_name' %}selected{% endif %}>–ü–æ —Ñ–∞–º–∏–ª–∏–∏ (–ê-–Ø)</option>
                </select>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-filter w-100">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
            </div>
        </form>

        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
    <tr>
        <th class="py-3">–î–µ–π—Å—Ç–≤–∏—è</th>
        <th class="py-3">ID</th>
        <th class="py-3">–î–∞—Ç–∞</th>
        <th class="py-3">–ò–º—è</th>
        <th class="py-3">–§–∞–º–∏–ª–∏—è</th>
        <th class="py-3">–¢–µ–ª–µ—Ñ–æ–Ω</th>
    </tr>
</thead>
                <tbody>
    {% for person in items %}
    <tr>
        <td>
            <div class="d-flex gap-2">
                <a href="{% url 'edit_feedback' person.id %}" class="btn btn-sm btn-outline-primary">‚úèÔ∏è –ü—Ä–∞–≤–∏—Ç—å</a>
                
                <a href="#" 
   class="btn btn-sm btn-outline-danger" 
   data-bs-toggle="modal" 
   data-bs-target="#deleteModal"
   data-first-name="{{ person.first_name }}"
   data-last-name="{{ person.last_name }}"
   data-url="{% url 'delete_feedback' person.id %}">
    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
</a>
            </div>
        </td>

        <td class="text-muted">#{{ person.id }}</td>

        <td class="text-muted" style="font-size: 0.85rem;">
            {{ person.created_at|date:"d.m.y H:i" }}
        </td>

        <td class="fw-semibold">{{ person.first_name }}</td>
        <td>{{ person.last_name }}</td>
        <td>
            <a href="tel:{{ person.phone }}" class="text-decoration-none fw-bold" style="color: #4b2c9e;">
                {{ person.phone }}
            </a>
        </td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="6" class="text-center py-5 text-muted">–ó–∞—è–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</td>
    </tr>
    {% endfor %}
</tbody>
            </table>
        </div>
    </div>
</div>
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header border-bottom-0 pt-4 px-4">
        <h5 class="modal-title fw-bold">üö® –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      
      <div class="modal-body py-3 px-4 text-center">
        <h4 class="mb-3 fw-bold">–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?</h4>
        <p class="text-muted mb-0">–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞—è–≤–∫—É –æ—Ç:</p>
        <div id="deleteTargetName" class="fs-5 fw-bold text-danger mt-1"></div>
      </div>

      <div class="modal-footer border-top-0 d-flex justify-content-center pb-4 px-4 gap-3">
        <button type="button" class="btn btn-light px-4 fw-semibold" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
        <a id="confirmDeleteBtn" href="#" class="btn btn-danger px-4 fw-semibold shadow-sm">–î–∞, —É–¥–∞–ª–∏—Ç—å</a>
      </div>
    </div>
  </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const deleteModal = document.getElementById('deleteModal');
        if (deleteModal) {
            deleteModal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                
                const firstName = button.getAttribute('data-first-name');
                const lastName = button.getAttribute('data-last-name');
                const url = button.getAttribute('data-url');
               
                const modalNameSpan = deleteModal.querySelector('#deleteTargetName');
                const modalConfirmBtn = deleteModal.querySelector('#confirmDeleteBtn');
                
                if (modalNameSpan) {
                    modalNameSpan.textContent = firstName + ' ' + lastName;
                }
                if (modalConfirmBtn) {
                    modalConfirmBtn.setAttribute('href', url);
                }
            });
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>